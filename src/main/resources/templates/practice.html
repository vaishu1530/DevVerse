<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <title>C Language Practice - DevVerse</title>
  <style>
    body{font-family: Arial; background:#f5fbff; margin:0}
    header{background:#0f74b8;color:#fff;padding:12px;text-align:center;}
    .wrap{max-width:1000px;margin:16px auto;padding:8px;}
    textarea{width:100%;height:280px;font-family:monospace;font-size:14px;padding:10px;}
    #output{white-space:pre-wrap;background:#111;color:#cfc;padding:12px;height:180px;overflow:auto;}
    button{background:#0f74b8;color:#fff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    select{padding:6px}
  </style>
</head>
<body>
<header>C Language Practice - DevVerse</header>

<div class="wrap">
  <div style="display:flex;gap:8px;align-items:center">
    <select id="language">
      <option value="c">C</option>
      <option value="cpp">C++</option>
      <option value="python3">Python 3</option>
    </select>
    <button id="runBtn">Run</button>
    <button id="clearBtn">Clear</button>
    <span id="status" style="margin-left:12px;color:#666"></span>
  </div>

  <textarea id="code">
// Sample C program
#include <stdio.h>
int main() {
    printf("Hello, DevVerse!\n");
    return 0;
}
  </textarea>

  <h3>Output</h3>
  <div id="output">Click Run to execute.</div>
</div>

<script>
  const runBtn = document.getElementById('runBtn');
  const clearBtn = document.getElementById('clearBtn');
  const codeEl = document.getElementById('code');
  const outputEl = document.getElementById('output');
  const languageEl = document.getElementById('language');
  const statusEl = document.getElementById('status');

  runBtn.addEventListener('click', async () => {
    outputEl.textContent = 'Running...';
    statusEl.textContent = '';
    runBtn.disabled = true;

    const payload = {
      code: codeEl.value,
      language: languageEl.value,
      versionIndex: '0' // JDoodle default, change if needed
    };

    try {
      const res = await fetch('/api/run', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if (res.ok) {
        outputEl.textContent = data.output || JSON.stringify(data, null, 2);
      } else {
        outputEl.textContent = 'Error: ' + (data.error || JSON.stringify(data));
      }
    } catch (err) {
      outputEl.textContent = 'Request failed: ' + err.message;
    } finally {
      runBtn.disabled = false;
    }
  });

  clearBtn.addEventListener('click', () => {
    codeEl.value = '';
    outputEl.textContent = '';
  });
</script>
</body>
</html>
